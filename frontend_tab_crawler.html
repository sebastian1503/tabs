<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chords Crawler</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-lg rounded-2xl p-8 w-full max-w-lg">
    <h1 class="text-2xl font-bold text-center mb-6">ðŸŽ¸ Chords Crawler</h1>
    <div class="mb-4">
      <label class="block mb-1 text-gray-700">Ultimate-Guitar URL:</label>
      <input id="url" type="text" placeholder="https://tabs.ultimate-guitar.com/..."
        class="w-full border border-gray-300 rounded-lg p-2" />
    </div>
    <div class="mb-4">
      <label class="block mb-1 text-gray-700">Transponiere um (HalbtÃ¶ne):</label>
      <input id="transpose" type="number" value="0"
        class="w-full border border-gray-300 rounded-lg p-2" />
    </div>
    <button id="generateBtn"
      class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
      PDF generieren
    </button>
    <p id="status" class="text-center mt-4 text-gray-700"></p>
  </div>

  <script>
    const backendUrl = "https://tabs-crawler.onrender.com/generate";

    document.getElementById("generateBtn").addEventListener("click", async () => {
      const url = document.getElementById("url").value;
      const transpose = document.getElementById("transpose").value;
      const status = document.getElementById("status");
      status.textContent = "Generiere PDF ...";

      try {
        const response = await fetch(backendUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url, transpose })
        });

        if (!response.ok) {
          const err = await response.json();
          status.textContent = "Fehler: " + err.error;
          return;
        }

        // Dateiname aus Content-Disposition extrahieren
        const disposition = response.headers.get("Content-Disposition");
        let filename = "song.pdf";
        if (disposition && disposition.indexOf("filename=") !== -1) {
          filename = disposition.split("filename=")[1].replace(/["']/g, '');
        }

        const blob = await response.blob();
        const downloadUrl = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = downloadUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(downloadUrl);
        status.textContent = "PDF erfolgreich erstellt!";
      } catch (e) {
        status.textContent = "Fehler: " + e.message;
      }
    });
  </script>
</body>
</html>
